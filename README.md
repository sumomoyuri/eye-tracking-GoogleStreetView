# eye-tracking-GoogleStreetView
eye tracking in case of exploring Google Street View using an eye tracker "Tobii Pro Nano" and visualization with video, panoramic images and, kernel density  
アイトラッカー（TobiiProNano）を用いた、Googleストリートビュー探索時のアイトラッキングと、動画、パノラマ画像、カーネル密度での視線の可視化

## 【概要】
アイトラッカー（TobiiProNano）を用いた、Googleストリートビュー探索時のアイトラッキングデータを記録し、動画への可視化や、GoogleストリートビューのURL情報をもとに生成したパオラマ画像上で可視化するための、一連のデータ処理プログラム。

## 【アイトラッカー Tobii Pro Nano】
`Tobii Pro Nano`：トビー社の小型軽量アイトラッカー。PC画面下部に設置することで、PC画面内の視線座標や瞳孔径をサンプリングレート60Hで記録することができる。

## 【視線データの記録　recorder.py】
Tobii Pro Nanoでアイトラッキングをするためには、専用の無料ソフトウェアである`Tobii Eye Tracker Manager`で、事前に位置関係の設定やサンプリングレートなどの設定や、被視線計測者の視線キャリブレーションを実施することが必要。  
本プログラムでは、`Tobii Eye Tracker Manager`での設定とキャリブレーション後に、`recorder.py`を実行することで、時刻と視線座標・瞳孔径を`output/gaze.csv`に出力することができる。  

出力データの形式は以下の通り。x,y座標はモニタの左上を原点として0〜1の間で記録され、瞳孔径はmm単位で記録されている。

|時刻|右目のx座標|右目のy座標|左目のx座標| 左目のy座標|右目の瞳孔径|左目の瞳孔径|右目瞳孔径データ有無|左目瞳孔径データ有無|
|:----|:----|:----|:----|:----|:----|:----|:----|:----|
|2021-05-14 10:14:30.012000|0.6005534529685974| 0.5111197829246521|0.6006736159324646| 0.5411497950553894|3.6480255127|3.5655670166|True|True|
|2021-05-14 10:14:30.012000|0.6005534529685974| 0.5111197829246521|0.6006736159324646| 0.5411497950553894|3.6480255127|3.5655670166|True|True|
|2021-05-14 10:14:30.028000|0.6024783849716187| 0.5084214210510254|0.6006250381469727| 0.5380455851554871|3.65855407715|3.58148193359|True|True|
|2021-05-14 10:14:30.028000|0.6024783849716187| 0.5084214210510254|0.6006250381469727| 0.5380455851554871|3.65855407715|3.58148193359|True|True|
|2021-05-14 10:14:30.045000|0.6006242036819458| 0.5084537267684937|0.5998525619506836| 0.537571132183075|3.65812683105|3.59248352051|True|True|
|2021-05-14 10:14:30.045000|0.6006242036819458| 0.5084537267684937|0.5998525619506836| 0.537571132183075|3.65812683105|3.59248352051|True|True|
|2021-05-14 10:14:30.061000|0.6033099293708801| 0.5138833522796631|0.6076745986938477| 0.5201295018196106|3.66387939453|3.59434509277|True|True|
|2021-05-14 10:14:30.061000|0.6033099293708801| 0.5138833522796631|0.6076745986938477| 0.5201295018196106|3.66387939453|3.59434509277|True|True|
|2021-05-14 10:14:30.078000|0.637449324131012| 0.5655802488327026|0.609611451625824| 0.5185182094573975|3.21092224121|3.52241516113|True|True|
|2021-05-14 10:14:30.078000|0.637449324131012| 0.5655802488327026|0.609611451625824| 0.5185182094573975|3.21092224121|3.52241516113|True|True|


## 【Googleストリートビューのカメラ情報の記録　get-url.ipynb】
Googleストリートビューの表示画面と視線データを紐付けて、パノラマ画像上で視線データを可視化するためには、Googleストリートビューで表示しているパノラマ画像のカメラ情報(方角、視野角、カメラアングルなど)を時刻とともに記録しておく必要がある。  
そして、その情報はURLに含まれているため、Googleストリートビュー探索時に（場所の移動や見回しによって）URLが変わるたびに、時刻とURLを記録しておくことで、時刻情報をもとに後からGoogleストリートビュー画像と視線データを紐付けることが出来る。
```
GoogleストリートビューのURLの例：　https://www.google.com/maps/@35.681537,139.766942,2a,75y,170h,90t...
```
この場合、緯度：`35.681537`　経度：`139.766942`　上下視野角：`75`　カメラ方位：`170`　仰角：`90`　となる。  

このURL情報の記録は、Google Chromeを操作することのできるモジュール`chromedriver`を用いて行う。
本プログラムでは、`get-url.ipynb`の各セルを順番に実行することで、まずは`recorder.py`を実行して視線データの記録を開始し、続けてchromedriverでブラウザのstreet viewを立ち上げることで、視線の記録と合わせてURLの記録を開始することができる。  
なお、被験者はchromedriverの有無を気にせず、通常通りキーボード操作やマウス操作でGoogleストリートビュー上を探索することができる。

出力データは以下の通り。

|時刻|緯度|経度|視野角|カメラ方位|カメラ上下角度|paneID|URL|
|:----|:----|:----|:----|:----|:----|:----|:----|
|2021-05-14 10:14:30.061915|35.6818905|139.7677372|75|285.59|90|7Bo4nn9EfYkz-rdzbsKfvw|https://www.google.com/maps/@35.6818905,139.7677372,2a,75y,285.59h,90t/data=!3m6!1e1!3m4!1s7Bo4nn9EfYkz-rdzbsKfvw!2e0!7i13312!8i6656|
|2021-05-14 10:14:32.362105|35.6818973|139.7677009|75|285.59|90|DSSW3-Ba0_LXifmOIlqGbQ|https://www.google.com/maps/@35.6818973,139.7677009,2a,75y,285.59h,90t/data=!3m6!1e1!3m4!1sDSSW3-Ba0_LXifmOIlqGbQ!2e0!7i13312!8i6656|
|2021-05-14 10:14:33.664514|35.6819062|139.7676692|75|285.59|90|OzNk__GpWXGr-AZPTFrehQ|https://www.google.com/maps/@35.6819062,139.7676692,2a,75y,285.59h,90t/data=!3m6!1e1!3m4!1sOzNk__GpWXGr-AZPTFrehQ!2e0!7i13312!8i6656|
|2021-05-14 10:14:35.880201|35.6819173|139.7676336|75|285.59|90|8PXGZrEDzwsiMIW7YDyK_Q|https://www.google.com/maps/@35.6819173,139.7676336,2a,75y,285.59h,90t/data=!3m6!1e1!3m4!1s8PXGZrEDzwsiMIW7YDyK_Q!2e0!7i13312!8i6656|
|2021-05-14 10:14:40.065441|35.6819266|139.7675971|75|285.59|90|ZP0jpwMOMlI98rv61nNHSQ|https://www.google.com/maps/@35.6819266,139.7675971,2a,75y,285.59h,90t/data=!3m6!1e1!3m4!1sZP0jpwMOMlI98rv61nNHSQ!2e0!7i13312!8i6656|
|2021-05-14 10:14:42.846908|35.6819266|139.7675971|75|292.6|90|ZP0jpwMOMlI98rv61nNHSQ|https://www.google.com/maps/@35.6819266,139.7675971,2a,75y,292.6h,90t/data=!3m6!1e1!3m4!1sZP0jpwMOMlI98rv61nNHSQ!2e0!7i13312!8i6656|
|2021-05-14 10:14:43.711487|35.6819266|139.7675971|75|299.87|90|ZP0jpwMOMlI98rv61nNHSQ|https://www.google.com/maps/@35.6819266,139.7675971,2a,75y,299.87h,90t/data=!3m6!1e1!3m4!1sZP0jpwMOMlI98rv61nNHSQ!2e0!7i13312!8i6656|
|2021-05-14 10:14:44.893362|35.6819355|139.7675625|75|299.87|90|897Qk7Djww5VYSYoJleJew|https://www.google.com/maps/@35.6819355,139.7675625,2a,75y,299.87h,90t/data=!3m6!1e1!3m4!1s897Qk7Djww5VYSYoJleJew!2e0!7i13312!8i6656|
|2021-05-14 10:14:46.031282|35.6819355|139.7675625|75|318.8|90|897Qk7Djww5VYSYoJleJew|https://www.google.com/maps/@35.6819355,139.7675625,2a,75y,318.8h,90t/data=!3m6!1e1!3m4!1s897Qk7Djww5VYSYoJleJew!2e0!7i13312!8i6656|
|2021-05-14 10:14:48.930007|35.6819355|139.7675625|75|327.44|90|897Qk7Djww5VYSYoJleJew|https://www.google.com/maps/@35.6819355,139.7675625,2a,75y,327.44h,90t/data=!3m6!1e1!3m4!1s897Qk7Djww5VYSYoJleJew!2e0!7i13312!8i6656|
